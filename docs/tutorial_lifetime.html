<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tutorial: Lifetime of objects returned by Wren | Wren Bind c++17</title>
    <meta name="description" content="Wren language binding library for C++17">
    
    
    <link rel="preload" href="/wrenbind17/assets/css/0.styles.9185cbf8.css" as="style"><link rel="preload" href="/wrenbind17/assets/js/app.4ed41ba3.js" as="script"><link rel="preload" href="/wrenbind17/assets/js/2.1224c7bf.js" as="script"><link rel="preload" href="/wrenbind17/assets/js/166.51de020e.js" as="script"><link rel="prefetch" href="/wrenbind17/assets/js/10.414c42e1.js"><link rel="prefetch" href="/wrenbind17/assets/js/100.45297f84.js"><link rel="prefetch" href="/wrenbind17/assets/js/101.fbb9ce22.js"><link rel="prefetch" href="/wrenbind17/assets/js/102.0b52da43.js"><link rel="prefetch" href="/wrenbind17/assets/js/103.6ef81ce4.js"><link rel="prefetch" href="/wrenbind17/assets/js/104.24cf2d6a.js"><link rel="prefetch" href="/wrenbind17/assets/js/105.7af80dc4.js"><link rel="prefetch" href="/wrenbind17/assets/js/106.a33a8a5b.js"><link rel="prefetch" href="/wrenbind17/assets/js/107.da1a0377.js"><link rel="prefetch" href="/wrenbind17/assets/js/108.337278a6.js"><link rel="prefetch" href="/wrenbind17/assets/js/109.a8794546.js"><link rel="prefetch" href="/wrenbind17/assets/js/11.972b7cfa.js"><link rel="prefetch" href="/wrenbind17/assets/js/110.f99d2dcd.js"><link rel="prefetch" href="/wrenbind17/assets/js/111.319029f3.js"><link rel="prefetch" href="/wrenbind17/assets/js/112.663d7306.js"><link rel="prefetch" href="/wrenbind17/assets/js/113.5ff47fe7.js"><link rel="prefetch" href="/wrenbind17/assets/js/114.ccf43870.js"><link rel="prefetch" href="/wrenbind17/assets/js/115.7646b944.js"><link rel="prefetch" href="/wrenbind17/assets/js/116.6f3d4851.js"><link rel="prefetch" href="/wrenbind17/assets/js/117.2da37c5b.js"><link rel="prefetch" href="/wrenbind17/assets/js/118.30e89287.js"><link rel="prefetch" href="/wrenbind17/assets/js/119.b94d1d9d.js"><link rel="prefetch" href="/wrenbind17/assets/js/12.13d3b109.js"><link rel="prefetch" href="/wrenbind17/assets/js/120.3c7d058c.js"><link rel="prefetch" href="/wrenbind17/assets/js/121.a80dbfbc.js"><link rel="prefetch" href="/wrenbind17/assets/js/122.f747690f.js"><link rel="prefetch" href="/wrenbind17/assets/js/123.af6f7853.js"><link rel="prefetch" href="/wrenbind17/assets/js/124.d7bc52c4.js"><link rel="prefetch" href="/wrenbind17/assets/js/125.3ca681bf.js"><link rel="prefetch" href="/wrenbind17/assets/js/126.d5630bcf.js"><link rel="prefetch" href="/wrenbind17/assets/js/127.792aff9f.js"><link rel="prefetch" href="/wrenbind17/assets/js/128.8268b42f.js"><link rel="prefetch" href="/wrenbind17/assets/js/129.26c78bfc.js"><link rel="prefetch" href="/wrenbind17/assets/js/13.02dc1cff.js"><link rel="prefetch" href="/wrenbind17/assets/js/130.3e75f728.js"><link rel="prefetch" href="/wrenbind17/assets/js/131.ef85c1cf.js"><link rel="prefetch" href="/wrenbind17/assets/js/132.643850c5.js"><link rel="prefetch" href="/wrenbind17/assets/js/133.fe2edf1e.js"><link rel="prefetch" href="/wrenbind17/assets/js/134.8d537388.js"><link rel="prefetch" href="/wrenbind17/assets/js/135.dfb229a3.js"><link rel="prefetch" href="/wrenbind17/assets/js/136.a0dd996d.js"><link rel="prefetch" href="/wrenbind17/assets/js/137.cdf12101.js"><link rel="prefetch" href="/wrenbind17/assets/js/138.ab2dc4be.js"><link rel="prefetch" href="/wrenbind17/assets/js/139.052eee80.js"><link rel="prefetch" href="/wrenbind17/assets/js/14.d811333d.js"><link rel="prefetch" href="/wrenbind17/assets/js/140.9fa22bb5.js"><link rel="prefetch" href="/wrenbind17/assets/js/141.417852f3.js"><link rel="prefetch" href="/wrenbind17/assets/js/142.995b9051.js"><link rel="prefetch" href="/wrenbind17/assets/js/143.8e3f67b5.js"><link rel="prefetch" href="/wrenbind17/assets/js/144.e001a054.js"><link rel="prefetch" href="/wrenbind17/assets/js/145.14c4fcab.js"><link rel="prefetch" href="/wrenbind17/assets/js/146.ac268f50.js"><link rel="prefetch" href="/wrenbind17/assets/js/147.e11307be.js"><link rel="prefetch" href="/wrenbind17/assets/js/148.d570353a.js"><link rel="prefetch" href="/wrenbind17/assets/js/149.9d7c5342.js"><link rel="prefetch" href="/wrenbind17/assets/js/15.467751e9.js"><link rel="prefetch" href="/wrenbind17/assets/js/150.31c9a632.js"><link rel="prefetch" href="/wrenbind17/assets/js/151.e6d254c7.js"><link rel="prefetch" href="/wrenbind17/assets/js/152.606b8b47.js"><link rel="prefetch" href="/wrenbind17/assets/js/153.aad43e0f.js"><link rel="prefetch" href="/wrenbind17/assets/js/154.8b5f98c6.js"><link rel="prefetch" href="/wrenbind17/assets/js/155.62c5a9ec.js"><link rel="prefetch" href="/wrenbind17/assets/js/156.7109d1ac.js"><link rel="prefetch" href="/wrenbind17/assets/js/157.c940e40c.js"><link rel="prefetch" href="/wrenbind17/assets/js/158.a87792c7.js"><link rel="prefetch" href="/wrenbind17/assets/js/159.c1dc1dc8.js"><link rel="prefetch" href="/wrenbind17/assets/js/16.dfa62744.js"><link rel="prefetch" href="/wrenbind17/assets/js/160.abfc416e.js"><link rel="prefetch" href="/wrenbind17/assets/js/161.edb5fc37.js"><link rel="prefetch" href="/wrenbind17/assets/js/162.f87bc443.js"><link rel="prefetch" href="/wrenbind17/assets/js/163.3b77727a.js"><link rel="prefetch" href="/wrenbind17/assets/js/164.f0e58f36.js"><link rel="prefetch" href="/wrenbind17/assets/js/165.a8581ee4.js"><link rel="prefetch" href="/wrenbind17/assets/js/167.e7f9a08a.js"><link rel="prefetch" href="/wrenbind17/assets/js/168.417c9162.js"><link rel="prefetch" href="/wrenbind17/assets/js/169.8e907a7c.js"><link rel="prefetch" href="/wrenbind17/assets/js/17.8704b4e8.js"><link rel="prefetch" href="/wrenbind17/assets/js/170.ccd6e380.js"><link rel="prefetch" href="/wrenbind17/assets/js/171.a0eb61ac.js"><link rel="prefetch" href="/wrenbind17/assets/js/172.4b8cd6fb.js"><link rel="prefetch" href="/wrenbind17/assets/js/173.48ad1352.js"><link rel="prefetch" href="/wrenbind17/assets/js/174.9f570dc9.js"><link rel="prefetch" href="/wrenbind17/assets/js/18.393f750f.js"><link rel="prefetch" href="/wrenbind17/assets/js/19.022dbc22.js"><link rel="prefetch" href="/wrenbind17/assets/js/20.9ab85f87.js"><link rel="prefetch" href="/wrenbind17/assets/js/21.90a13c9c.js"><link rel="prefetch" href="/wrenbind17/assets/js/22.c52ac89d.js"><link rel="prefetch" href="/wrenbind17/assets/js/23.2169a86a.js"><link rel="prefetch" href="/wrenbind17/assets/js/24.de4ffe39.js"><link rel="prefetch" href="/wrenbind17/assets/js/25.6d19e1ae.js"><link rel="prefetch" href="/wrenbind17/assets/js/26.634880f4.js"><link rel="prefetch" href="/wrenbind17/assets/js/27.75fc6d69.js"><link rel="prefetch" href="/wrenbind17/assets/js/28.3bbd9960.js"><link rel="prefetch" href="/wrenbind17/assets/js/29.478158a8.js"><link rel="prefetch" href="/wrenbind17/assets/js/3.b53fd91f.js"><link rel="prefetch" href="/wrenbind17/assets/js/30.7e09b84f.js"><link rel="prefetch" href="/wrenbind17/assets/js/31.974b45fe.js"><link rel="prefetch" href="/wrenbind17/assets/js/32.7c6d7164.js"><link rel="prefetch" href="/wrenbind17/assets/js/33.876b552d.js"><link rel="prefetch" href="/wrenbind17/assets/js/34.f5f3206e.js"><link rel="prefetch" href="/wrenbind17/assets/js/35.07a1f7b4.js"><link rel="prefetch" href="/wrenbind17/assets/js/36.881efdc2.js"><link rel="prefetch" href="/wrenbind17/assets/js/37.af1c2af9.js"><link rel="prefetch" href="/wrenbind17/assets/js/38.d02c3497.js"><link rel="prefetch" href="/wrenbind17/assets/js/39.a6b6be0c.js"><link rel="prefetch" href="/wrenbind17/assets/js/4.6abe49ea.js"><link rel="prefetch" href="/wrenbind17/assets/js/40.9f99a4b0.js"><link rel="prefetch" href="/wrenbind17/assets/js/41.0485b6af.js"><link rel="prefetch" href="/wrenbind17/assets/js/42.b0b3063d.js"><link rel="prefetch" href="/wrenbind17/assets/js/43.d142bacc.js"><link rel="prefetch" href="/wrenbind17/assets/js/44.e78de31d.js"><link rel="prefetch" href="/wrenbind17/assets/js/45.35770f45.js"><link rel="prefetch" href="/wrenbind17/assets/js/46.76c4da7f.js"><link rel="prefetch" href="/wrenbind17/assets/js/47.1354887e.js"><link rel="prefetch" href="/wrenbind17/assets/js/48.de8e1944.js"><link rel="prefetch" href="/wrenbind17/assets/js/49.1a41ad10.js"><link rel="prefetch" href="/wrenbind17/assets/js/5.53ea1345.js"><link rel="prefetch" href="/wrenbind17/assets/js/50.bac363a4.js"><link rel="prefetch" href="/wrenbind17/assets/js/51.ee92ae70.js"><link rel="prefetch" href="/wrenbind17/assets/js/52.c36abc0b.js"><link rel="prefetch" href="/wrenbind17/assets/js/53.e8638284.js"><link rel="prefetch" href="/wrenbind17/assets/js/54.d0bb431d.js"><link rel="prefetch" href="/wrenbind17/assets/js/55.b2159665.js"><link rel="prefetch" href="/wrenbind17/assets/js/56.0752aa93.js"><link rel="prefetch" href="/wrenbind17/assets/js/57.2acb6ab1.js"><link rel="prefetch" href="/wrenbind17/assets/js/58.143191a3.js"><link rel="prefetch" href="/wrenbind17/assets/js/59.b92af387.js"><link rel="prefetch" href="/wrenbind17/assets/js/6.82cb4bab.js"><link rel="prefetch" href="/wrenbind17/assets/js/60.a66400b6.js"><link rel="prefetch" href="/wrenbind17/assets/js/61.90fc781c.js"><link rel="prefetch" href="/wrenbind17/assets/js/62.d3ea9b2a.js"><link rel="prefetch" href="/wrenbind17/assets/js/63.40923337.js"><link rel="prefetch" href="/wrenbind17/assets/js/64.ea796d03.js"><link rel="prefetch" href="/wrenbind17/assets/js/65.d75a3274.js"><link rel="prefetch" href="/wrenbind17/assets/js/66.fba80b14.js"><link rel="prefetch" href="/wrenbind17/assets/js/67.f153b2ce.js"><link rel="prefetch" href="/wrenbind17/assets/js/68.21d125b1.js"><link rel="prefetch" href="/wrenbind17/assets/js/69.639ac26e.js"><link rel="prefetch" href="/wrenbind17/assets/js/7.8ef04cbe.js"><link rel="prefetch" href="/wrenbind17/assets/js/70.68a88878.js"><link rel="prefetch" href="/wrenbind17/assets/js/71.a608cf23.js"><link rel="prefetch" href="/wrenbind17/assets/js/72.01be5951.js"><link rel="prefetch" href="/wrenbind17/assets/js/73.06890c05.js"><link rel="prefetch" href="/wrenbind17/assets/js/74.42216ca7.js"><link rel="prefetch" href="/wrenbind17/assets/js/75.c1b27489.js"><link rel="prefetch" href="/wrenbind17/assets/js/76.39edb860.js"><link rel="prefetch" href="/wrenbind17/assets/js/77.60c25b7c.js"><link rel="prefetch" href="/wrenbind17/assets/js/78.a94dfcb3.js"><link rel="prefetch" href="/wrenbind17/assets/js/79.05321a37.js"><link rel="prefetch" href="/wrenbind17/assets/js/8.a08debce.js"><link rel="prefetch" href="/wrenbind17/assets/js/80.a426615f.js"><link rel="prefetch" href="/wrenbind17/assets/js/81.d045e443.js"><link rel="prefetch" href="/wrenbind17/assets/js/82.64d341f3.js"><link rel="prefetch" href="/wrenbind17/assets/js/83.d7253c36.js"><link rel="prefetch" href="/wrenbind17/assets/js/84.f89f51ae.js"><link rel="prefetch" href="/wrenbind17/assets/js/85.48958f1e.js"><link rel="prefetch" href="/wrenbind17/assets/js/86.777f4dc9.js"><link rel="prefetch" href="/wrenbind17/assets/js/87.12f7b65f.js"><link rel="prefetch" href="/wrenbind17/assets/js/88.c3925e09.js"><link rel="prefetch" href="/wrenbind17/assets/js/89.6eca8f53.js"><link rel="prefetch" href="/wrenbind17/assets/js/9.7b15538d.js"><link rel="prefetch" href="/wrenbind17/assets/js/90.540abb83.js"><link rel="prefetch" href="/wrenbind17/assets/js/91.8ed01d30.js"><link rel="prefetch" href="/wrenbind17/assets/js/92.8be0b817.js"><link rel="prefetch" href="/wrenbind17/assets/js/93.07fe4e54.js"><link rel="prefetch" href="/wrenbind17/assets/js/94.b747e209.js"><link rel="prefetch" href="/wrenbind17/assets/js/95.d617835b.js"><link rel="prefetch" href="/wrenbind17/assets/js/96.b4304e34.js"><link rel="prefetch" href="/wrenbind17/assets/js/97.e3f91ecd.js"><link rel="prefetch" href="/wrenbind17/assets/js/98.4594d2b3.js"><link rel="prefetch" href="/wrenbind17/assets/js/99.71b8d237.js">
    <link rel="stylesheet" href="/wrenbind17/assets/css/0.styles.9185cbf8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wrenbind17/" class="home-link router-link-active"><!----> <span class="site-name">Wren Bind c++17</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wrenbind17/" class="nav-link">Home</a></div><div class="nav-item"><a href="/wrenbind17/docs/tutorial.html" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/modules.html" class="nav-link">Modules</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Classes</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/annotated.html" class="nav-link">Class List</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/classes.html" class="nav-link">Class Index</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/hierarchy.html" class="nav-link">Class Hierarchy</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_members.html" class="nav-link">Class Members</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_functions.html" class="nav-link">Class Member Functions</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_variables.html" class="nav-link">Class Member Variables</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_typedefs.html" class="nav-link">Class Member Typedefs</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_enums.html" class="nav-link">Class Member Enumerations</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Namespaces</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespaces.html" class="nav-link">Namespace List</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_members.html" class="nav-link">Namespace Members</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_functions.html" class="nav-link">Namespace Member Functions</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_variables.html" class="nav-link">Namespace Member Variables</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_typedefs.html" class="nav-link">Namespace Member Typedefs</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_enums.html" class="nav-link">Namespace Member Enumerations</a></li></ul></div></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/files.html" class="nav-link">Files</a></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/pages.html" class="nav-link">Pages</a></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/bug.html" class="nav-link">Bugs</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wrenbind17/" class="nav-link">Home</a></div><div class="nav-item"><a href="/wrenbind17/docs/tutorial.html" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/modules.html" class="nav-link">Modules</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Classes</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/annotated.html" class="nav-link">Class List</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/classes.html" class="nav-link">Class Index</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/hierarchy.html" class="nav-link">Class Hierarchy</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_members.html" class="nav-link">Class Members</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_functions.html" class="nav-link">Class Member Functions</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_variables.html" class="nav-link">Class Member Variables</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_typedefs.html" class="nav-link">Class Member Typedefs</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/class_member_enums.html" class="nav-link">Class Member Enumerations</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Namespaces</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespaces.html" class="nav-link">Namespace List</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_members.html" class="nav-link">Namespace Members</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_functions.html" class="nav-link">Namespace Member Functions</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_variables.html" class="nav-link">Namespace Member Variables</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_typedefs.html" class="nav-link">Namespace Member Typedefs</a></li><li class="dropdown-item"><!----> <a href="/wrenbind17/docs/doxygen/namespace_member_enums.html" class="nav-link">Namespace Member Enumerations</a></li></ul></div></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/files.html" class="nav-link">Files</a></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/pages.html" class="nav-link">Pages</a></div><div class="nav-item"><a href="/wrenbind17/docs/doxygen/bug.html" class="nav-link">Bugs</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tutorial: Lifetime of objects returned by Wren</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wrenbind17/docs/tutorial_lifetime.html#return-global-variables" class="sidebar-link">Return global variables</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wrenbind17/docs/tutorial_lifetime.html#return-local-variables" class="sidebar-link">Return local variables</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wrenbind17/docs/tutorial_lifetime.html#using-std-shared-ptr" class="sidebar-link">Using std::shared_ptr</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wrenbind17/docs/tutorial_lifetime.html#lifetime-of-objects-passed-to-c-functions" class="sidebar-link">Lifetime of objects passed to C++ functions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wrenbind17/docs/tutorial_lifetime.html#tl-dr" class="sidebar-link">TL;DR</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tutorial-lifetime-of-objects-returned-by-wren"><a href="#tutorial-lifetime-of-objects-returned-by-wren" aria-hidden="true" class="header-anchor">#</a> Tutorial: Lifetime of objects returned by Wren</h1> <h2 id="return-global-variables"><a href="#return-global-variables" aria-hidden="true" class="header-anchor">#</a> Return global variables</h2> <p>Suppose you have created an instance of a C++ class in Wren as a global variable:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;mymodule&quot;</span> <span class="token keyword">for</span> Foo

<span class="token comment">// Starts with capital letter so we can access it inside</span>
<span class="token comment">// functions and classes</span>
<span class="token keyword">var</span> Instance <span class="token operator">=</span> Foo<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Instance
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then if you access the instance via C++:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span><span class="token operator">&amp;</span> main <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;main()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wren<span class="token operator">::</span>Any result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Foo cpy <span class="token operator">=</span> result<span class="token punctuation">.</span>as<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// cpy is now a copy of Wren's Foo instance.</span>
<span class="token comment">// The lifetime of cpy or &quot;Instance&quot; is not modified.</span>
</code></pre></div><p>Then nothing much happens because you are creating a copy of Foo. But what if you access it by a pointer?</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span><span class="token operator">&amp;</span> main <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;main()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
wren<span class="token operator">::</span>Any result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Foo<span class="token operator">*</span> ptr <span class="token operator">=</span> result<span class="token punctuation">.</span>as<span class="token operator">&lt;</span>Foo<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ptr points to the same instance as Wren's &quot;Instance&quot; var.</span>

<span class="token comment">// Using this pointer is OK because the instance will be alive</span>
<span class="token comment">// until the Wren VM shuts down.</span>
ptr<span class="token operator">-&gt;</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">delete</span> ptr<span class="token punctuation">;</span> <span class="token comment">// Segmentation fault, memory is managed by Wren!</span>
</code></pre></div><p>Then you have a pointer to the same instance, but when will it get free? Only when Wren VM gets shut doen (VM gets deleted, falls out of the scope, etc). So the pointer you get is valid as long as the VM is alive. <strong>After that, it will get deleted by Wren, so don't free it manually!</strong></p> <h2 id="return-local-variables"><a href="#return-local-variables" aria-hidden="true" class="header-anchor">#</a> Return local variables</h2> <p>But what about returning local variables?</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;mymodule&quot;</span> <span class="token keyword">for</span> Foo

<span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Foo<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then if you access the instance via C++:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span><span class="token operator">&amp;</span> main <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;main()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Foo<span class="token operator">*</span> ptr <span class="token operator">=</span> null<span class="token punctuation">;</span>

<span class="token punctuation">{</span> <span class="token comment">// Inside of some scope</span>
    wren<span class="token operator">::</span>Any result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr <span class="token operator">=</span> result<span class="token punctuation">.</span>as<span class="token operator">&lt;</span>Foo<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr<span class="token operator">-&gt;</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
<span class="token punctuation">}</span>

<span class="token comment">// At this point, the result (wren::Any)</span>
<span class="token comment">// has been destroyed because it has fallen out of the scope</span>

ptr<span class="token operator">-&gt;</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Undefined bahvior</span>
</code></pre></div><p>The Wren language is garbage collected. Therefore once the variable is out of the scope, it may or may not be destroyed. It depends on the implementation of the language. But! <strong>The wren::Any will extend the lifetime of the object</strong> so you can use the pointer as long as the result is alive.</p> <h2 id="using-std-shared-ptr"><a href="#using-std-shared-ptr" aria-hidden="true" class="header-anchor">#</a> Using std::shared_ptr</h2> <p>One way to avoid these bad scenarios is to use modern C++11 features! If you use this:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">auto</span><span class="token operator">&amp;</span> main <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token string">&quot;main()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


wren<span class="token operator">::</span>Any result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span> ptr <span class="token operator">=</span> result<span class="token punctuation">.</span>shared<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ptr<span class="token operator">-&gt;</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>
</code></pre></div><p>So now you have extended the lifetime of the Foo instance by using a shared pointer. This shared pointer points to the exact same instance as the internal implementation of this library. The instances are passed around as a shared pointer (even if you pass it as a raw pointer), so the Foo will be alive even after the Wren VM has shut down. The memory will be managed by both C++ and Wren, because all C++ class instances are shared pointers.</p> <p>If it is still confusing, then you can think of it as:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// Let's think of this as wren::Any (result of a function call)</span>
std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span> result<span class="token punctuation">;</span>

Foo<span class="token operator">*</span> ptr <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Obviously dangerous</span>
std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span> ptr <span class="token operator">=</span> result<span class="token punctuation">;</span> <span class="token comment">// Safe</span>
</code></pre></div><div class="warning custom-block"><p>Warning!</p> <p>This is all OK until your Foo instance from above will use some additional Wren variables. If it is just a plain C++ class and you have only created it on the Wren side, then you have nothing to worry about. If your C++ class contains some other Wren instances, then it really depends on your own implementation of your application.</p></div> <h2 id="lifetime-of-objects-passed-to-c-functions"><a href="#lifetime-of-objects-passed-to-c-functions" aria-hidden="true" class="header-anchor">#</a> Lifetime of objects passed to C++ functions</h2> <p>So how does all of the above behave on C++ functions? Suppose we have the following:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token comment">// Danger! We will get an instance of local</span>
    <span class="token comment">// Foo variable from Wren. This pointer may be invalid </span>
    <span class="token comment">// once you exit this function! The pointer will be </span>
    <span class="token comment">// valid only during the execution of this function body.</span>
    <span class="token keyword">void</span> <span class="token function">setParent</span><span class="token punctuation">(</span>Foo<span class="token operator">*</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>And then inside of Wren code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        child<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>It will behave exactly same as returning a variable from calling Wren function! The pointer will point to the local Wren instance that may be garbage collected almost right after the call has been made. Don't pass instances like that. Either make the instance a global Wren variable or use smart pointers as shown below:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token comment">// Much better and it's safe!</span>
    <span class="token keyword">void</span> <span class="token function">setParent</span><span class="token punctuation">(</span>std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>And then inside of Wren code:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        child<span class="token punctuation">.</span><span class="token function">setParent</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tl-dr"><a href="#tl-dr" aria-hidden="true" class="header-anchor">#</a> TL;DR</h2> <ul><li>Getting <code>Foo</code> from Wren is OK.</li> <li>Getting <code>Foo*</code> from Wren is OK as long as the variable in Wren is global. (Or you somehow ensure that you use the dangling pointer on C++ safely, for example using it only inside of the C++ function being called).</li> <li>Getting <code>Foo&amp;</code> from Wren is same as <code>Foo*</code>.</li> <li>Getting <code>std::shared_ptr&lt;Foo&gt;</code> is always safe.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/wrenbind17/assets/js/app.4ed41ba3.js" defer></script><script src="/wrenbind17/assets/js/2.1224c7bf.js" defer></script><script src="/wrenbind17/assets/js/166.51de020e.js" defer></script>
  </body>
</html>
